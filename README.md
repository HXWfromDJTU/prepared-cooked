# prepared-cooked

## 🎯 最新更新

### v0.5.0 - 合并准备台和组装台 (2025-09-22)
- 🔄 **简化工作流程**：
  - 将准备台和组装台合并为一个组装台
  - 组装台现在可以直接处理解冻后的食材
  - 游戏流程简化为：取食材 → 解冻 → 组装 → 上菜
  - 移除了让玩家困惑的准备环节

### v0.4.1 - 游戏逻辑优化 (2025-09-22)
- 🧹 **移除清洗区功能**：
  - 预制菜游戏中不需要清洗功能，简化游戏流程
  - 移除所有清洗相关的代码和UI元素
  - 优化厨房布局，腾出更多空间用于其他功能

### v0.4.0 - 网格化系统与精确食材存储 (2025-09-22)
- 🎯 **网格化地图系统**：
  - 厨师按格子移动，每次移动一个格子（40x40像素）
  - 地板显示虚线网格，清晰标示移动区域
  - 地图尺寸优化为800x600，更适合游戏体验
- 🥘 **精确食材存储系统**：
  - 每种食材都有独立的存储格子（羊排、牛肋排、土豆、白菜等）
  - 告别模糊的"肉类"、"蔬菜"分类，每个格子只存储一种具体食材
  - 实时显示每种食材的剩余数量
- 🏗️ **工作台网格化布局**：
  - 每个可操作单元占用2个格子
  - 环形工作台设计，操作流程更顺畅
  - 微波炉、上菜口等都按网格精确定位
- 🎮 **改进的移动体验**：
  - 平滑的格子间移动动画
  - 精确的交互检测系统
  - 支持WASD和方向键控制

### v0.3.0 - 订单进度条系统 (2025-09-22)
- ✨ **新增订单进度条**：每个订单都有实时更新的进度条，直观显示剩余时间
- 🎨 **动态紧急状态系统**：
  - 正常状态：绿色到黄色渐变进度条
  - 紧急状态（<20秒）：橙色脉冲动画效果
  - 危急状态（<10秒）：红色闪烁进度条 + 抖动动画
- 🎮 **增强游戏体验**：流畅的动画效果，增加紧张感和沉浸感
- ⚡ **性能优化**：智能UI更新机制，避免不必要的DOM重建

---

## 原始需求描述
1. 参照原型: overcooked(https://en.wikipedia.org/wiki/Overcooked)
2. 游戏核心描述
    - 风格与玩法: 参考 overcooked 的游戏模式，做像素风的网页游戏
    - 食物菜单模块设计 
      - prepared-cooked 所有食材原料都为预制菜，所有菜品都是原料通过微波炉解冻后即可使用。
      - 但是客户点餐的食物，需要 1～N 个微波炉解冻后的原料进行组装后，才可以上菜
    - 客户派单系统: 可以参考 overcooked 原来的游戏设计
    - 玩家人数: overcooked原游戏支持多人合租，但当前游戏仅需支持单人
    - 游戏时间: 单局游戏时长 3 分钟

## 需求分析与技术方案

### 技术栈选择
- **游戏引擎**: Phaser.js (开源免费的2D游戏引擎，适合像素风游戏)
- **前端技术**: HTML5 + JavaScript + CSS
- **数据存储**: localStorage (存储游戏设置、最高分等)
- **开发工具**: 无需后端，纯前端实现

### 游戏机制设计

#### 操作控制
- **移动控制**: WASD 键 + 方向键
- **交互控制**: 
  - 空格键: 通用交互（拿取/放置物品）
  - E键: 操作设备（微波炉解冻、洗盘子等）
- **游戏视角**: 俯视图
- **移动方式**: 正常行走（暂不支持奔跑）

#### 食材与菜品系统
- **菜品来源**: 参考西贝官网菜品 (https://www.xibei.com.cn/web/page/23.html)
- **配料设计**: 每个成品菜拆分成1-5种预制配料
- **难度搭配**: 简单菜品1-2种配料，复杂菜品3-5种配料
- **解冻机制**: 不同食材有固定解冻时间
  - 肉类（如大棒骨）: 8-10分钟
  - 蔬菜类: 2-3分钟
  - 半成品: 4-6分钟

#### 难度系统
- **Easy模式**: 
  - 客户点单频率较低
  - 主要是1-2种配料的简单菜品
  - 给予更多准备时间
- **Medium模式**: 
  - 中等点单频率
  - 2-3种配料的菜品为主
  - 标准游戏节奏
- **Hard模式**: 
  - 高频点单
  - 3-5种配料的复杂菜品
  - 时间压力较大

#### 游戏流程
1. 客户下单 → 显示所需菜品
2. 玩家取预制食材 → 放入微波炉解冻
3. 解冻完成 → 取出食材进行组装
4. 完成菜品 → 上菜给客户
5. 获得分数 → 继续下一单

### 设计确认

#### 厨房布局
- **微波炉**: 2台（提高游戏效率，避免等待瓶颈）
- **食材储存区**: 1个（存放各种预制菜原料）
- **组装工作台**: 1个（组合解冻后的食材）
- **上菜区**: 1个（完成的菜品放置处，客户取餐）
- **洗盘子区域**: 1个（清洁餐具，循环使用）

#### 评分系统
- **基础分数**: 按时完成订单获得基础分数（根据菜品复杂度）
- **时间奖励**: 提前完成订单获得额外分数
- **连击奖励**: 连续完成订单获得连击加分
- **评分显示**: 仅显示数字分数，不需要星级评价系统

#### UI风格设计
- **整体风格**: 像素风格，但避免过度马赛克化，保持清晰可读
- **色调方案**: 参考西贝莜面村的暖色调风格（橙黄、棕色、米色等）
- **Logo元素**: 可使用西贝莜面村的餐厅logo设计元素
- **界面布局**: 简洁明了，突出游戏操作区域

#### 交互键设置（最终确认）
- **移动**: WASD键 + 方向键
- **通用交互**: 空格键（拿取/放置/操作设备/上菜等所有交互操作）

## 最新更新记录

### 2024-12-22 - 订单进度条系统 ⏰
- ✅ **可视化进度条**: 为每个订单添加了实时进度条，直观显示剩余时间
- ✅ **动态紧急状态**: 
  - 正常状态：绿色到黄色渐变进度条
  - 紧急状态（<20秒）：橙色脉冲效果 + 边框高亮
  - 危急状态（<10秒）：红色闪烁效果 + 抖动动画
- ✅ **平滑动画效果**: 订单出现/消失的流畅过渡动画
- ✅ **性能优化**: 智能UI更新，避免不必要的DOM重建
- ✅ **客户信息显示**: 增加客户姓名显示，增强代入感
- ✅ **耐心度反馈**: 客户耐心度的视觉化表现

### 2024-12-22 - 游戏机制完善 🔧
- ✅ **工作台功能区分**: 修复了准备台和组装台的功能差异
- ✅ **真实配方系统**: 实现了基于食材组合的菜品制作逻辑
- ✅ **完整烹饪流程**: 取食材 → 解冻 → 准备台处理 → 组装台组合 → 上菜
- ✅ **食材状态追踪**: 四种状态管理（生食材、解冻食材、已处理食材、完成菜品）
- ✅ **智能提示系统**: 显示组装台状态和所需食材提示

### 2024-12-22 - 厨房布局优化 🏠
- ✅ **环形工作台设计**: 厨房外圈由连续工作台围成
- ✅ **分类食材存储**: 不同食材分布在不同工作台（肉类台、蔬菜台、半成品台）
- ✅ **微波炉机制完善**: 
  - 单一食材限制，一次只能解冻一种食材
  - 实时状态显示（食材名称、剩余时间、进度条）
  - 手动取出机制，解冻完成需要玩家主动取出

## 开发计划

### 第一阶段：项目基础搭建
1. **项目结构设置**：创建基本的文件结构
2. **Phaser.js集成**：引入游戏引擎和基础配置
3. **基础游戏场景**：创建主菜单和游戏场景框架

### 第二阶段：核心游戏机制
1. **玩家角色**：实现角色移动和交互系统
2. **厨房布局**：绘制游戏地图和各个功能区域
3. **食材系统**：实现预制菜和解冻机制

### 第三阶段：游戏逻辑
1. **订单系统**：客户点餐和菜品需求管理
2. **制作流程**：从取材到上菜的完整流程
3. **评分系统**：分数计算和显示

### 第四阶段：优化完善
1. **UI美化**：像素风格界面设计
2. **音效和动画**：提升游戏体验
3. **难度平衡**：调整游戏难度和测试

## 项目结构
```
prepared-cooked/
├── index.html              # 主页面
├── css/
│   └── style.css          # 样式文件
├── js/
│   ├── main.js            # 游戏主入口
│   ├── scenes/
│   │   ├── MenuScene.js   # 主菜单场景
│   │   └── GameScene.js   # 游戏场景
│   ├── entities/
│   │   ├── Player.js      # 玩家角色
│   │   ├── Kitchen.js     # 厨房布局
│   │   └── Food.js        # 食材系统
│   ├── systems/
│   │   ├── OrderSystem.js # 订单系统
│   │   └── ScoreSystem.js # 评分系统
│   └── utils/
│       └── GameData.js    # 游戏数据管理
├── assets/
│   ├── images/            # 图片资源
│   ├── sounds/            # 音效资源
│   └── data/              # 游戏数据文件
└── README.md              # 项目说明
```

## 如何运行游戏

### 方法一：直接打开
1. 双击 `index.html` 文件
2. 游戏将在默认浏览器中打开

### 方法二：本地服务器（推荐）
```bash
# 使用Python启动本地服务器
python -m http.server 8000

# 或使用Node.js
npx http-server

# 然后在浏览器访问 http://localhost:8000
```

### 游戏操作
- **移动**: WASD 键或方向键
- **交互**: 空格键（拿取/放置/操作设备）
- **暂停**: ESC 键
- **查看说明**: ESC 键（在主菜单或游戏中）

## 当前开发状态

### ✅ 已完成功能
- [x] 项目基础架构搭建
- [x] Phaser.js 游戏引擎集成
- [x] 主菜单场景（难度选择）
- [x] 游戏主场景框架
- [x] 玩家角色移动和基础交互
- [x] **厨房布局重新设计** - 环形工作台布局
- [x] **分散食材存储系统** - 按类别分布的存储区域
- [x] **完善的微波炉机制** - 状态管理、进度条、手动取出
- [x] 食材系统基础框架
- [x] 订单系统（自动生成订单）
- [x] 评分系统（分数计算、连击奖励）
- [x] 游戏计时器和UI显示
- [x] 本地存储（最高分记录）
- [x] 像素风格UI设计

### 🚧 开发中功能
- [ ] 完整的食材解冻流程
- [ ] 菜品组装系统
- [ ] 订单匹配和完成逻辑
- [ ] 微波炉状态管理
- [ ] 游戏音效和动画

## ✅ 已完成的重要改进

### 1. 厨房布局重新设计 ✅
**改进内容**: 
- ✅ 厨房外圈由一圈连续的厨房工作台围起来
- ✅ 微波炉、上菜口、各种食材存储都是工作台的组成部分
- ✅ 形成环形的工作流布局，提高操作效率
- ✅ 中央活动区域供玩家自由移动

### 2. 食材存储分布优化 ✅
**改进内容**: 
- ✅ 不同的原始食材分布在厨房的不同工作台上
- ✅ 肉类台、蔬菜台、半成品台分别存放对应食材
- ✅ 每个存储台只存放特定类型的食材
- ✅ 玩家需要到对应的台子去取相应的食材
- ✅ 添加了类别图标和颜色区分

### 3. 微波炉机制完善 ✅
**改进内容**: 
- ✅ **单一食材限制**: 一次只能同时解冻一种食材
- ✅ **状态显示**: 显示当前解冻的食材名称
- ✅ **时间显示**: 显示剩余解冻时间（精确到秒）
- ✅ **进度条UI**: 添加可视化的解冻进度条
- ✅ **手动取出**: 解冻完成后需要玩家手动取出，微波炉才能放入下一个食材
- ✅ **状态管理**: 微波炉有空闲、工作中、完成待取出三种状态
- ✅ **视觉反馈**: 解冻完成时有颜色变化和提示效果

## 🔧 最新修复 (2025-09-22)

### 修复的核心游戏逻辑问题：

#### 1. **准备台 vs 组装台功能明确化**
- **准备台**：将解冻后的食材进行切配处理，转换为"已处理的食材"
- **组装台**：按照菜品配方组合多种已处理的食材，制作完成菜品
- **明确区分**：解冻食材 → 准备台处理 → 组装台组合 → 完成菜品

#### 2. **真正的配方组装系统**
- ❌ **修复前**：单个解冻食材可以直接变成"料理"
- ✅ **修复后**：必须按照配方要求的食材组合才能制作菜品
- **配方检查**：系统会自动检测组装台上的食材是否匹配某个菜品配方
- **智能提示**：显示当前已添加的食材，帮助玩家了解进度

#### 3. **完整的烹饪工作流程**
```
1. 取食材 (分类存储台) 
   ↓
2. 解冻 (微波炉) 
   ↓  
3. 处理 (准备台 - 切配/调味)
   ↓
4. 组装 (组装台 - 按配方组合)
   ↓
5. 上菜 (上菜区)
```

#### 4. **食材追踪系统**
- **原始ID保留**：食材在整个处理过程中保留原始ID信息
- **状态转换**：`raw_ingredient` → `defrosted_ingredient` → `prepared_ingredient` → `finished_dish`
- **配方匹配**：基于原始食材ID进行配方匹配，确保准确性

### 📋 待开发功能
- [ ] 图片资源和精灵动画
- [ ] 更丰富的视觉效果
- [ ] 游戏平衡性调整
- [ ] 更多菜品和食材
- [ ] 成就系统
- [ ] 游戏教程

## 技术栈
- **游戏引擎**: Phaser.js 3.70.0
- **前端技术**: HTML5 + CSS3 + JavaScript (ES6+)
- **数据存储**: localStorage
- **开发工具**: 无需构建工具，纯前端实现

## 游戏特色
- 🍳 基于西贝莜面村真实菜品设计
- 🎨 像素风格界面，温馨的餐厅色调
- ⚡ 快节奏的烹饪挑战
- 🏆 完善的评分和连击系统
- 📱 响应式设计，支持不同屏幕尺寸
